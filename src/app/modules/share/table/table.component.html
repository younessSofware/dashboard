<div class="mx-4">
  <div class="my-3">
    <span class="text-3xl uppercase my-2"><i [class]="icon + ' mx-2'"></i>List of {{ pluralName }}</span>
    <hr>
  </div>
  <div class="flex justify-end items-center">
    <span class="nowrap mr-3">Per page</span>
    <select name="limit" (change)="getData()" [(ngModel)]="limit" placeholder="per page" class="rounded-lg" id="sorter">
      <option value="20">20</option>
      <option value="50">50</option>
      <option value="20">100</option>
      <option value="20">500</option>
    </select>
    <div class="flex items-center mx-2">
      <span class="nowrap mr-3">Sort by</span>
      <select name="sortBy" [(ngModel)]="sortBy" (change)="getData()" name="" placeholder="sort by" class="rounded-lg flex-1 uppercase" id="sorter">
        <option class="uppercase" [value]="header.name" *ngFor="let header of sortableHeaders()">{{ header.title }}</option>
      </select>
    </div>
    <div class="ml-1 mr-2">
      <select name="sortDir" [(ngModel)]="sortDir" (change)="getData()"  class="rounded-lg">
        <option value="1">ASC</option>
        <option value="-1">DESC</option>
      </select>
    </div>
    <div class="flex ml-1">
      <input (keyup.enter)="getData()" name="searchQuery" [(ngModel)]="searchQuery" type="text" placeholder="search" class="rounded-lg" >
      <button (click)="getData()" class="bg-transparent border-2 border-indigo-300 rounded-lg p-2 px-4 mx-2 hover:bg-indigo-400 hover:text-white"><i class="fas fa-search"></i></button>
    </div>
    <div>
      <button
        [routerLink]="[createLink]"
        *ngIf="showCreateButton"
        class="bg-transparent border-2 border-indigo-300 p-2 px-3 rounded-lg hover:bg-indigo-400 hover:text-white"
      >
        <i class="fas fa-plus mx-1"></i> Create {{ singleName }}
      </button>
    </div>
    <div>
      <button
        (click)="getData()"
        class="bg-transparent border-2 ml-2 border-indigo-300 p-2 px-3 rounded-lg hover:bg-indigo-400 hover:text-white"
      >
        <i class="fas fa-sync-alt mx-1"></i> Refresh
      </button>
    </div>
  </div>

  <div class="my-3" >
    <app-alert title="Success" [message]="success" type="success" *ngIf="success"></app-alert>
    <app-alert title="Error" [message]="error" type="danger" *ngIf="error" ></app-alert>
  </div>
  <div class="flex flex-col mt-4 border-t-2 border-gray-200">
    <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
      <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
        <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
          <div class="bg-white py-3 px-2 flex items-center justify-between border-t border-gray-200">
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
              <button
                [class.disabled]="!canPrevious()"
                [disabled]="!canPrevious()"
                (click)="previousPage()"
                class="bg-transparent text-blue-500 p-2 border-2 border-gray-300 hover:bg-blue-100"
              >
                <i class="fas fa-arrow-left mx-1"></i> Previous
              </button>
              <nav class="relative z-0 inline-flex rounded-md shadow-sm" aria-label="Pagination">
                <a
                  [class.active]="currentPage == page"
                  (click)="currentPage = page;getData()"
                  *ngFor="let page of pages"
                  class="bg-white cursor-pointer border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center py-2 px-4 border text-sm font-medium"
                >
                  {{ page }}
                </a>
              </nav>
              <button
                [class.disabled]="!canNext()"
                [disabled]="!canNext()"
                (click)="nextPage()"
                class="bg-transparent text-blue-500 p-2 border-2 border-gray-300 hover:bg-blue-100"
              >
                Next <i class="fas fa-arrow-right mx-1"></i>
              </button>
            </div>
          </div>
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-black">
              <tr>
                <th
                  *ngFor="let header of headers"
                  scope="col"
                  class="py-3 px-2 text-center text-xs font-medium  text-white uppercase tracking-wider"
                >
                  {{ header.title }}
                </th>
                <th scope="col" class="relative px-6 py-3">
                  <span class="sr-only">Edit</span>
                </th>
              </tr>
            </thead>
            <tbody *ngIf="data && data.length" class="bg-white divide-y divide-gray-200">
              <tr [class.bg-gray-100]="ind % 2" *ngFor="let d of data; let ind = index">
                <td class="py-4 whitespace-nowrap text-center px-2 border-2 border-gray-200" *ngFor="let header of headers">
                  <section [ngSwitch]="header.type">
                    <img *ngSwitchCase="'avatar'" [src]="d[header.name]" class="h-10 w-10 rounded-full mx-auto ring-2 ring-gray-300" alt="">
                    <span
                      *ngSwitchCase="'boolean'"
                      class="p-2 px-3 inline-flex cursor-pointer text-sm leading-5 font-semibold rounded-full"
                      [ngClass]="[(header.reverseBooleanColors ? !d[header.name] : d[header.name]) ? 'bg-green-100' : 'bg-red-100']"
                    >
                      {{ header.values ? header.values[d[header.name] ? 1 : 0] : 0 }}
                    </span>
                    <span *ngSwitchCase="'date'"> {{ d[header.name] | date: "medium" }} </span>
                    <div class="text-sm text-gray-900" *ngSwitchDefault>{{ d[header.name] | resumeText: header.maxLength ? header.maxLength : null }}</div>
                  </section>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right">
                  <button
                    [routerLink]="[displayLink]"
                    [queryParams]="{
                      id: d['_id']
                    }"
                    class="border-2 border-indigo-200 py-2 px-3 rounded-md hover:bg-indigo-200 mx-1 text-xs"
                  >
                    <i class="fas fa-eye"></i>
                  </button>
                  <button
                    [routerLink]="[editLink]"
                    *ngIf="showUpdateButton"
                    [queryParams]="{id: d['_id']}"
                    class="border-2 border-gray-200 py-2 px-3 rounded-md hover:bg-gray-400 hover:text-white mx-1 text-xs"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    (click)="deleteRow(d, ind)"
                    *ngIf="showDeleteButton"
                    class="border-2 border-red-200 py-2 px-3 rounded-md hover:bg-red-400 hover:text-white mx-1 text-xs"
                  >
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf='!data && !error' class="w-full text-center">
            <span class="animate-ping inline-flex h-2 w-full bg-purple-400 opacity-75"></span>
          </div>
          <app-alert [title]="error" type="danger" *ngIf="!data && error"></app-alert>
          <app-alert title="Empty Result" message="No data found (0)" type="info" *ngIf="data && !data.length"></app-alert>
        </div>
      </div>
    </div>
  </div>
</div>
